class c{constructor(){this.tocContainer=document.getElementById("table-of-contents"),this.tocList=document.getElementById("toc-list"),this.tocToggle=document.getElementById("toc-toggle"),!(!this.tocContainer||!this.tocList)&&(this.headings=[],this.currentActiveId=null,this.isDragging=!1,this.dragStartX=0,this.dragStartY=0,this.currentX=0,this.currentY=0,this.initialX=0,this.initialY=0,this.lastMoveTime=0,this.velocity={x:0,y:0},this.animationFrame=null,this.dragBounds={minX:0,maxX:0,minY:0,maxY:0},this.init())}init(){this.extractHeadings(),this.buildTOC(),this.setupEventListeners(),this.setupDragListeners(),this.updateActiveSection(),this.restorePosition(),this.calculateDragBounds(),this.detectPageType(),this.headings.length===0&&(this.tocContainer.style.display="none")}detectPageType(){const t=window.location.pathname.includes("/projects/")&&!window.location.pathname.endsWith("/projects/")&&!window.location.pathname.endsWith("/projects"),e=window.location.pathname.endsWith("/projects/")||window.location.pathname.endsWith("/projects"),i=window.location.pathname.includes("/blog/")&&!window.location.pathname.endsWith("/blog/")&&!window.location.pathname.endsWith("/blog");e?document.body.classList.add("project-page"):(t||i)&&document.body.classList.add("blog-page")}extractHeadings(){const t=[".project-content",".post-content","main article","main"];let e=null;for(const n of t)if(e=document.querySelector(n),e)break;if(!e)return;const i=e.querySelectorAll("h1, h2, h3, h4, h5, h6");this.headings=Array.from(i).map((n,s)=>{if(!n.id){const o=n.textContent||"";n.id=`heading-${s}-${o.toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}`}return{element:n,id:n.id,text:n.textContent||"",level:parseInt(n.tagName.charAt(1))}})}buildTOC(){this.headings.length!==0&&(this.tocList.innerHTML="",this.headings.forEach(t=>{const e=document.createElement("li");e.className="toc-item";const i=document.createElement("a");i.href=`#${t.id}`,i.className="toc-link",i.textContent=t.text,i.setAttribute("data-level",t.level.toString()),i.addEventListener("click",n=>{n.preventDefault(),this.scrollToHeading(t.id)}),e.appendChild(i),this.tocList.appendChild(e)}))}setupEventListeners(){this.tocToggle&&this.tocToggle.addEventListener("click",()=>{this.tocContainer.classList.toggle("collapsed")});let t=!1;window.addEventListener("scroll",()=>{t||(requestAnimationFrame(()=>{this.updateActiveSection(),t=!1}),t=!0)}),window.addEventListener("resize",()=>{this.calculateDragBounds()})}calculateDragBounds(){const t=this.tocContainer.getBoundingClientRect(),e=20;this.dragBounds={minX:-t.width/2+e,maxX:window.innerWidth-t.width/2-e,minY:-t.height/2+e,maxY:window.innerHeight-t.height/2-e}}updateActiveSection(){if(this.headings.length===0)return;const t=window.scrollY+100;let e=null;for(let i=this.headings.length-1;i>=0;i--){const n=this.headings[i];if(n.element.offsetTop<=t){e=n;break}}if(e&&e.id!==this.currentActiveId){const i=this.tocList.querySelector(".toc-link.active"),n=this.tocList.querySelector(".toc-item.active");i&&i.classList.remove("active"),n&&n.classList.remove("active");const s=this.tocList.querySelector(`[href="#${e.id}"]`);s&&(s.classList.add("active"),s.parentElement.classList.add("active"),this.scrollTOCToActiveItem(s)),this.currentActiveId=e.id}}scrollTOCToActiveItem(t){const e=this.tocContainer.querySelector(".toc-nav");if(!e)return;const i=t.getBoundingClientRect(),n=e.getBoundingClientRect();if(i.top<n.top||i.bottom>n.bottom){const s=t.offsetTop-e.offsetTop-e.clientHeight/2+t.clientHeight/2;e.scrollTo({top:s,behavior:"smooth"})}}scrollToHeading(t){const e=document.getElementById(t);if(!e)return;const n=e.offsetTop-80;window.scrollTo({top:n,behavior:"smooth"}),history.pushState&&history.pushState(null,null,`#${t}`)}setupDragListeners(){this.tocContainer.addEventListener("mousedown",this.dragStart.bind(this)),document.addEventListener("mousemove",this.dragMove.bind(this)),document.addEventListener("mouseup",this.dragEnd.bind(this)),this.tocContainer.addEventListener("touchstart",this.dragStart.bind(this),{passive:!1}),document.addEventListener("touchmove",this.dragMove.bind(this),{passive:!1}),document.addEventListener("touchend",this.dragEnd.bind(this)),this.tocContainer.addEventListener("dragstart",t=>t.preventDefault())}dragStart(t){if(t.target.closest(".toc-toggle")||t.target.closest(".toc-link")||t.target.closest(".toc-nav")&&!t.target.closest(".toc-header"))return;this.isDragging=!0,this.tocContainer.classList.add("dragging"),this.tocContainer.classList.add("drag-preview");const e=t.type==="touchstart"?t.touches[0].clientX:t.clientX,i=t.type==="touchstart"?t.touches[0].clientY:t.clientY,n=window.getComputedStyle(this.tocContainer),s=new DOMMatrix(n.transform);this.currentX=s.m41,this.currentY=s.m42,this.dragStartX=e-this.currentX,this.dragStartY=i-this.currentY,this.lastMoveTime=Date.now(),this.velocity={x:0,y:0},this.calculateDragBounds(),t.preventDefault()}dragMove(t){if(!this.isDragging)return;t.preventDefault();const e=t.type==="touchmove"?t.touches[0].clientX:t.clientX,i=t.type==="touchmove"?t.touches[0].clientY:t.clientY,n=e-this.dragStartX,s=i-this.dragStartY,o=Date.now(),a=o-this.lastMoveTime;a>0&&(this.velocity.x=(n-this.currentX)/a*1e3,this.velocity.y=(s-this.currentY)/a*1e3),this.currentX=n,this.currentY=s,this.lastMoveTime=o,this.currentX=Math.max(this.dragBounds.minX,Math.min(this.dragBounds.maxX,this.currentX)),this.currentY=Math.max(this.dragBounds.minY,Math.min(this.dragBounds.maxY,this.currentY)),this.tocContainer.style.transform=`translate3d(${this.currentX}px, ${this.currentY}px, 0)`}dragEnd(t){if(!this.isDragging)return;this.isDragging=!1,this.tocContainer.classList.remove("dragging"),this.tocContainer.classList.remove("drag-preview"),this.tocContainer.classList.add("snap-back"),setTimeout(()=>{this.tocContainer.classList.remove("snap-back")},400);const e=500;(Math.abs(this.velocity.x)>e||Math.abs(this.velocity.y)>e)&&this.applyMomentum(),this.savePosition(),t.preventDefault()}applyMomentum(){const i=()=>{this.velocity.x*=.95,this.velocity.y*=.95,this.currentX+=this.velocity.x*.016,this.currentY+=this.velocity.y*.016,this.currentX=Math.max(this.dragBounds.minX,Math.min(this.dragBounds.maxX,this.currentX)),this.currentY=Math.max(this.dragBounds.minY,Math.min(this.dragBounds.maxY,this.currentY)),this.tocContainer.style.transform=`translate3d(${this.currentX}px, ${this.currentY}px, 0)`,Math.abs(this.velocity.x)>.1||Math.abs(this.velocity.y)>.1?this.animationFrame=requestAnimationFrame(i):this.savePosition()};this.animationFrame&&cancelAnimationFrame(this.animationFrame),this.animationFrame=requestAnimationFrame(i)}savePosition(){const t=window.location.pathname.includes("/projects/")&&!window.location.pathname.endsWith("/projects/")&&!window.location.pathname.endsWith("/projects"),e=window.location.pathname.endsWith("/projects/")||window.location.pathname.endsWith("/projects"),i=window.location.pathname.includes("/blog/")&&!window.location.pathname.endsWith("/blog/")&&!window.location.pathname.endsWith("/blog"),n={x:this.currentX,y:this.currentY,isProjectsIndexPage:e,isBlogLikePage:t||i};localStorage.setItem("toc-position",JSON.stringify(n))}restorePosition(){const t=localStorage.getItem("toc-position");if(t)try{const e=JSON.parse(t),i=window.location.pathname.includes("/projects/")&&!window.location.pathname.endsWith("/projects/")&&!window.location.pathname.endsWith("/projects"),n=window.location.pathname.endsWith("/projects/")||window.location.pathname.endsWith("/projects"),s=window.location.pathname.includes("/blog/")&&!window.location.pathname.endsWith("/blog/")&&!window.location.pathname.endsWith("/blog"),o=i||s;e.isProjectsIndexPage===n&&e.isBlogLikePage===o&&(this.currentX=e.x||0,this.currentY=e.y||0,this.calculateDragBounds(),(this.currentX<this.dragBounds.minX||this.currentX>this.dragBounds.maxX||this.currentY<this.dragBounds.minY||this.currentY>this.dragBounds.maxY)&&(this.currentX=0,this.currentY=0),this.tocContainer.style.transform=`translate3d(${this.currentX}px, ${this.currentY}px, 0)`)}catch(e){console.warn("Failed to restore TOC position:",e)}}}document.addEventListener("DOMContentLoaded",()=>{new c});document.addEventListener("astro:page-load",()=>{new c});
