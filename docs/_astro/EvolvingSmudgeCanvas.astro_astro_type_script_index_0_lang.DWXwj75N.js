class w{canvas;ctx;particles=[];isDrawing=!1;prevPosition={x:0,y:0};colorPhase=0;animationFrameId=null;colorInterval=null;colorPalettes=[["#3498db","#2980b9","#1abc9c","#16a085"],["#e74c3c","#c0392b","#f39c12","#d35400"],["#9b59b6","#8e44ad","#3498db","#2980b9"],["#f1c40f","#f39c12","#e67e22","#d35400"],["#1abc9c","#16a085","#2ecc71","#27ae60"]];constructor(){if(this.canvas=document.getElementById("smudge-canvas"),!this.canvas){console.error("Smudge canvas element not found!");return}const e=this.canvas.getContext("2d");if(!e){console.error("Could not get 2d context!");return}this.ctx=e,this.init()}init(){this.setupCanvas(),this.setupEventListeners(),this.startColorEvolution(),this.startRenderLoop()}setupCanvas(){this.resizeCanvas(),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),window.addEventListener("resize",this.handleResize)}handleResize=()=>{this.resizeCanvas()};resizeCanvas(){const t=this.canvas.parentElement.getBoundingClientRect();this.canvas.width=t.width-40,this.canvas.height=t.height-40,this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}getCurrentPalette(){return this.colorPalettes[Math.floor(this.colorPhase)%this.colorPalettes.length]}getRandomColor(){const e=this.getCurrentPalette(),t=(Math.floor(this.colorPhase)+1)%this.colorPalettes.length,s=this.colorPalettes[t],n=this.colorPhase%1,i=Math.floor(Math.random()*e.length),o=e[i],l=s[i],r=this.hexToRgb(o),a=this.hexToRgb(l),c=Math.floor(r.r*(1-n)+a.r*n),h=Math.floor(r.g*(1-n)+a.g*n),d=Math.floor(r.b*(1-n)+a.b*n);return`rgb(${c}, ${h}, ${d})`}hexToRgb(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}}startColorEvolution(){this.colorInterval=window.setInterval(()=>{this.colorPhase+=.005},100)}setupEventListeners(){this.canvas.addEventListener("mousedown",this.startDrawing),this.canvas.addEventListener("mousemove",this.draw),this.canvas.addEventListener("mouseup",this.stopDrawing),this.canvas.addEventListener("mouseleave",this.stopDrawing),this.canvas.addEventListener("touchstart",this.handleTouchStart),this.canvas.addEventListener("touchmove",this.handleTouchMove),this.canvas.addEventListener("touchend",this.stopDrawing),document.getElementById("clear-btn")?.addEventListener("click",this.clearCanvas),document.getElementById("save-btn")?.addEventListener("click",this.saveCanvas)}getPosition(e){const t=this.canvas.getBoundingClientRect();return"touches"in e?{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}:{x:e.clientX-t.left,y:e.clientY-t.top}}startDrawing=e=>{this.isDrawing=!0;const t=this.getPosition(e);this.prevPosition=t};draw=e=>{if(!this.isDrawing)return;const t=this.getPosition(e);this.createParticles(t.x,t.y,this.prevPosition.x,this.prevPosition.y),this.prevPosition=t};stopDrawing=()=>{this.isDrawing=!1};handleTouchStart=e=>{e.preventDefault(),this.isDrawing=!0;const t=this.getPosition(e);this.prevPosition=t};handleTouchMove=e=>{if(e.preventDefault(),!this.isDrawing)return;const t=this.getPosition(e);this.createParticles(t.x,t.y,this.prevPosition.x,this.prevPosition.y),this.prevPosition=t};createParticles(e,t,s,n){const i=e-s,o=t-n,l=Math.sqrt(i*i+o*o),r=Math.atan2(o,i),a=Math.max(Math.floor(l/5),1);for(let c=0;c<a;c++){const h=a===1?0:c/(a-1),d=s+i*h,f=n+o*h,g=2,p=Math.cos(r)*2+(Math.random()-.5)*g,x=Math.sin(r)*2+(Math.random()-.5)*g,P=3+Math.floor(Math.random()*3);for(let u=0;u<P;u++)this.particles.push({x:d+(Math.random()-.5)*10,y:f+(Math.random()-.5)*10,vx:p+(Math.random()-.5)*2,vy:x+(Math.random()-.5)*2,color:this.getRandomColor(),life:50+Math.random()*100,maxLife:50+Math.random()*100})}}startRenderLoop(){const e=()=>{this.ctx.fillStyle="rgba(0, 0, 0, 0.03)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);for(let t=this.particles.length-1;t>=0;t--){const s=this.particles[t];if(s.x+=s.vx,s.y+=s.vy,s.vx*=.98,s.vy*=.98,s.life--,s.life<=0){this.particles.splice(t,1);continue}const n=s.life/s.maxLife;this.ctx.beginPath(),this.ctx.arc(s.x,s.y,3+n*5,0,Math.PI*2),this.ctx.fillStyle=s.color.replace("rgb","rgba").replace(")",`, ${n})`),this.ctx.fill()}this.animationFrameId=requestAnimationFrame(e)};e()}clearCanvas=()=>{this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.particles=[]};saveCanvas=()=>{const e=this.canvas.toDataURL("image/png"),t=document.createElement("a");t.download=`evolving-smudge-${new Date().toISOString().slice(0,10)}.png`,t.href=e,t.click()};destroy(){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.colorInterval&&window.clearInterval(this.colorInterval),window.removeEventListener("resize",this.handleResize)}}function v(){document.getElementById("smudge-canvas")?new w:setTimeout(v,100)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",v):v();
