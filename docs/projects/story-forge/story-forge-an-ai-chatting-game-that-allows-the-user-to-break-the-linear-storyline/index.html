<!DOCTYPE html><html lang="en" data-astro-cid-37fxchfa> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Story Forge: AI-Powered Nonlinear Narrative Game - Projects</title><meta name="description" content="A full-stack AI-driven text adventure game engine that lets players break the linear storyline and co-create unique stories."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://laurence-wu.github.io/projects/story-forge/story-forge-an-ai-chatting-game-that-allows-the-user-to-break-the-linear-storyline/"><meta property="og:title" content="Story Forge: AI-Powered Nonlinear Narrative Game - Projects"><meta property="og:description" content="A full-stack AI-driven text adventure game engine that lets players break the linear storyline and co-create unique stories."><meta property="og:image" content="/assets/profile-image.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://laurence-wu.github.io/projects/story-forge/story-forge-an-ai-chatting-game-that-allows-the-user-to-break-the-linear-storyline/"><meta property="twitter:title" content="Story Forge: AI-Powered Nonlinear Narrative Game - Projects"><meta property="twitter:description" content="A full-stack AI-driven text adventure game engine that lets players break the linear storyline and co-create unique stories."><meta property="twitter:image" content="/assets/profile-image.jpg"><!-- KaTeX CSS for Math Rendering --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous"><!-- Google Fonts - Preserved Typography System --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Cormorant+Garamond:wght@300;400;500;600;700&display=swap" rel="stylesheet"><!-- Fira Code for code blocks --><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><!-- Global CSS Import --><link rel="stylesheet" href="/_astro/_slug_.CaX6V1Dz.css">
<style>@keyframes floatingWave{0%,to{transform:translate(0) translateY(0) scale(1);background-position:0% 0%,100% 100%,50% 50%}25%{transform:translate(10px) translateY(-15px) scale(1.02);background-position:10% 10%,90% 90%,60% 40%}50%{transform:translate(-5px) translateY(10px) scale(.98);background-position:20% 30%,80% 70%,30% 70%}75%{transform:translate(-15px) translateY(-5px) scale(1.01);background-position:30% 20%,70% 80%,40% 60%}}@keyframes gridWave{0%,to{transform:translate(0) translateY(0) rotate(0);opacity:.6}33%{transform:translate(20px) translateY(-10px) rotate(.5deg);opacity:.4}66%{transform:translate(-10px) translateY(15px) rotate(-.3deg);opacity:.8}}.main-content[data-astro-cid-dmqsi53g]{margin-top:0;min-height:calc(100vh - 80px);position:relative;z-index:1}.main-content[data-astro-cid-dmqsi53g]>[data-astro-cid-dmqsi53g]{position:relative;z-index:2}.main-content[data-astro-cid-dmqsi53g]:before{content:"";position:fixed;inset:80px 0 0;background:radial-gradient(circle at 20% 20%,rgba(138,154,126,.15) 0%,transparent 50%),radial-gradient(circle at 80% 80%,rgba(212,175,55,.1) 0%,transparent 50%),radial-gradient(circle at 40% 60%,rgba(138,154,126,.08) 0%,transparent 50%);background-color:#f4e8d1;background-size:100px 100px,150px 150px,200px 200px;animation:floatingWave 20s ease-in-out infinite;z-index:-1;pointer-events:none}.main-content[data-astro-cid-dmqsi53g]:after{content:"";position:fixed;inset:80px 0 0;background-image:linear-gradient(rgba(138,154,126,.05) 1px,transparent 1px),linear-gradient(90deg,rgba(138,154,126,.05) 1px,transparent 1px),linear-gradient(rgba(212,175,55,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(212,175,55,.03) 1px,transparent 1px);background-size:50px 50px,50px 50px,80px 80px,80px 80px;animation:gridWave 20s ease-in-out infinite;z-index:-1;pointer-events:none}
</style>
<link rel="stylesheet" href="/_astro/_slug_.eRVIt0LY.css">
<link rel="stylesheet" href="/_astro/index.BCrk01Mj.css"></head> <body data-astro-cid-37fxchfa> <nav class="navbar" data-astro-cid-pux6a34n> <div class="navbar-brand" data-astro-cid-pux6a34n>Xiaoyou Wu</div> <a href="/" class="navbar-link " data-astro-cid-pux6a34n>
Home
</a> <a href="/blog" class="navbar-link " data-astro-cid-pux6a34n>
Blog
</a> <a href="/projects" class="navbar-link active" data-astro-cid-pux6a34n>
Projects
</a> <a href="/about" class="navbar-link " data-astro-cid-pux6a34n>
About
</a> </nav>  <script type="module">function r(){const e=document.querySelector(".navbar");window.scrollY>50?e?.classList.add("scrolled"):e?.classList.remove("scrolled")}window.addEventListener("scroll",r);document.querySelector(".navbar")?.addEventListener("contextmenu",e=>{e.preventDefault()});document.querySelector(".navbar")?.addEventListener("dragstart",e=>{e.preventDefault()});</script> <main class="main-content" data-astro-cid-37fxchfa>  <main class="main-content" data-astro-cid-dmqsi53g>  <article class="project-detail" data-astro-cid-5uq7evlv> <header class="project-header" data-astro-cid-5uq7evlv> <div class="container" data-astro-cid-5uq7evlv> <h1 data-astro-cid-5uq7evlv>Story Forge: AI-Powered Nonlinear Narrative Game</h1> <p class="project-description" data-astro-cid-5uq7evlv>A full-stack AI-driven text adventure game engine that lets players break the linear storyline and co-create unique stories.</p> <div class="project-meta" data-astro-cid-5uq7evlv> <div class="project-dates" data-astro-cid-5uq7evlv> <time datetime="2025-07-31T00:00:00.000Z" data-astro-cid-5uq7evlv> July 2025 </time> </div> <div class="project-links" data-astro-cid-5uq7evlv> <a href="http://115.29.205.103/" class="project-link github-link" target="_blank" rel="noopener noreferrer" data-astro-cid-5uq7evlv> <span data-astro-cid-5uq7evlv>View on GitHub</span> </a> </div> </div> <div class="project-technologies" data-astro-cid-5uq7evlv> <h3 data-astro-cid-5uq7evlv>Technologies Used</h3> <div class="tech-tags" data-astro-cid-5uq7evlv> <span class="tech-tag" data-astro-cid-5uq7evlv>AI</span><span class="tech-tag" data-astro-cid-5uq7evlv>Game Engine</span><span class="tech-tag" data-astro-cid-5uq7evlv>React</span><span class="tech-tag" data-astro-cid-5uq7evlv>TypeScript</span><span class="tech-tag" data-astro-cid-5uq7evlv>WebSockets</span><span class="tech-tag" data-astro-cid-5uq7evlv>Prompt Engineering</span><span class="tech-tag" data-astro-cid-5uq7evlv>Full Stack</span> </div> </div> </div> </header> <div id="table-of-contents" class="toc-container" data-astro-cid-xvrfupwn> <div class="toc-header" data-astro-cid-xvrfupwn> <div class="toc-title-area" data-astro-cid-xvrfupwn> <span class="drag-handle" title="Drag to move" data-astro-cid-xvrfupwn>⋮⋮</span> <h3 data-astro-cid-xvrfupwn>Table of Contents</h3> </div> <button id="toc-toggle" class="toc-toggle" aria-label="Toggle table of contents" data-astro-cid-xvrfupwn> <span class="toggle-icon" data-astro-cid-xvrfupwn>←</span> </button> </div> <nav class="toc-nav" aria-label="Table of contents" data-astro-cid-xvrfupwn> <ul id="toc-list" class="toc-list" data-astro-cid-xvrfupwn> <!-- TOC items will be populated by JavaScript --> </ul> </nav> </div>  <script type="module" src="/_astro/TableOfContents.astro_astro_type_script_index_0_lang.ZAa9MuU5.js"></script> <main class="project-content" data-astro-cid-5uq7evlv> <div class="container" data-astro-cid-5uq7evlv> <div class="content-with-sidebar" data-astro-cid-5uq7evlv> <div class="main-content" data-astro-cid-5uq7evlv>  <p><em>(sorry this is not an open source project)</em></p>
<h2 id="my-feelings-to-this-project">My feelings to this project</h2>
<p>This is a project that, when I first heard its idea,  a thought just hits me: Fuck everything and I’m gonna make this project happen. It felt like the project I was always meant to work on—one that connected a deep fascination with philosophy to the art of creating for the web. During that hackathon, our team built it within 3 days and got the first price in software development track.</p>
<h2 id="project-overview">Project Overview</h2>
<blockquote>
<p>A revolutionary text adventure game engine that breaks the boundaries between player agency and narrative coherence</p>
</blockquote>
<p>At its heart, Story Forge was born from a simple but powerful idea: what if a story wasn’t just something you followed, but something you helped create meaning for? We looked at traditional games and saw beautiful, handcrafted tales, but they were almost <strong>always on rails</strong>. You follow the path, maybe choose a branch here or there, but the destination and its meaning are already set for you. <strong>We wanted to break free from that. We imagined a game where the player’s journey could give a story its soul.</strong></p>
<blockquote>
<p>Think of it like a single word. On its own, a word is just a word. But when you place it in a sentence, surrounded by a story you’ve built yourself, its meaning transforms. That’s what we want you to feel. By interacting with the world and its AI-driven characters, you build your own unique path, your own personal context. So when you finally reach that shared ending, it feels different for you than it would for anyone else, because the journey that brought you there was yours and yours alone. It’s an incredibly personal experience, and for now, we’re excited to be sharing it with our players in Chinese.</p>
</blockquote>
<p>Play the game : StoryForge <a href="http://115.29.205.103/">http://115.29.205.103/</a></p>
<h2 id="technical-details">Technical Details</h2>
<p>The project is a full-stack application with a sophisticated architecture designed to handle real-time, AI-driven narrative generation.</p>
<ul>
<li><strong>Architecture &#x26; Tech Stack:</strong>
<ul>
<li><strong>Frontend:</strong> Built with <strong>React</strong> using <strong>TypeScript</strong>, which was chosen for its strong typing and structural benefits. It includes a separate visual component for rendering the story’s dependency tree.</li>
<li><strong>Backend:</strong> The core of the backend is a <strong>dependency tree</strong> that manages narrative logic and prerequisites for events. It uses <strong>JSON</strong> and <strong>YML</strong> files for configuration and data exchange.</li>
<li><strong>Communication Protocol:</strong> The project uses <strong>WebSockets</strong> for real-time, bidirectional communication between the client and server. This was chosen over a standard HTTP API because its streaming nature perfectly matches the dynamic, continuous flow of the storytelling engine.</li>
<li><strong>AI Integration:</strong> The system uses <strong>OpenRouter</strong> to access large language models like <strong>Gemini</strong>. A critical backend component is a custom <strong>prompt engine</strong> designed to force the AI to generate responses in a structured <strong>JSON</strong> format that the dependency tree can parse.</li>
<li><strong>Deployment:</strong> The application is containerized using <strong>Docker</strong> and deployed on <strong>Chinese hosting services</strong> to cater to the target market and avoid issues with the Great Firewall of China.</li>
</ul>
</li>
<li><strong>Key Technical Challenges and Learnings:</strong>
<ul>
<li><strong>Session Management:</strong> Managing <strong>session IDs</strong> in a WebSocket environment was a major challenge. It is crucial for separating the data of different users (and even different game instances from the same user) to prevent narrative overlap. Improper handling could lead to bugs and security vulnerabilities.</li>
<li><strong>AI as a Bottleneck:</strong> The speed of the third-party AI API was the primary performance bottleneck. This was mitigated by implementing <strong>lazy loading</strong> and <strong>streaming</strong> responses to the frontend.</li>
<li><strong>Prompt Engineering:</strong> The team learned that effective <strong>prompt engineering</strong> is a vital and often underestimated skill. Crafting precise prompts was necessary to ensure the AI returned reliable, correctly formatted JSON data for the dependency tree.</li>
<li><strong>Development Strategy:</strong> The team adopted a <strong>decoupling</strong> strategy, building and testing complex features (like the tree renderer) in an isolated environment before integrating them into the main project. They also learned the value of setting up a simple frontend-backend connection test before starting full development.</li>
<li><strong>State and Code Management:</strong> Proper frontend architecture was essential. This included carefully indexing components, separating CSS and TSX files, implementing robust <strong>error handlers</strong> for key functions, and managing distinct application states (e.g., <code>game_start</code>, <code>narrative_output</code>, <code>special_choice</code>).</li>
</ul>
</li>
</ul>
<h2 id="architecture">Architecture</h2>
<h3 id="backend-components">Backend Components</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>StoryForge/</span></span>
<span class="line"><span>├── engine.py              # Core game engine</span></span>
<span class="line"><span>├── socket_server.py       # WebSocket server</span></span>
<span class="line"><span>├── agents/                # AI agent implementations</span></span>
<span class="line"><span>│   ├── arbiter.py         # Decision validation</span></span>
<span class="line"><span>│   ├── narrator.py        # Story generation</span></span>
<span class="line"><span>│   └── reality_agent.py   # Reality reconstruction</span></span>
<span class="line"><span>├── models/                # Data models</span></span>
<span class="line"><span>│   ├── story.py           # Story structures</span></span>
<span class="line"><span>│   ├── context.py         # Game context</span></span>
<span class="line"><span>│   └── agents.py          # Agent interfaces</span></span>
<span class="line"><span>├── utils/                 # Utilities</span></span>
<span class="line"><span>│   ├── llm_service.py     # LLM integration</span></span>
<span class="line"><span>│   ├── save_manager.py    # Save system</span></span>
<span class="line"><span>│   └── command_handler.py # Command processing</span></span>
<span class="line"><span>└── data/story/            # Story definitions</span></span>
<span class="line"><span>    └── [story-name]/</span></span>
<span class="line"><span>        ├── world_definition.yaml</span></span>
<span class="line"><span>        ├── condition_tree.yaml</span></span>
<span class="line"><span>        └── images/</span></span></code></pre>
<h3 id="frontend-components">Frontend Components</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>frontend/</span></span>
<span class="line"><span>├── src/</span></span>
<span class="line"><span>│   ├── components/        # React components</span></span>
<span class="line"><span>│   │   ├── Stage.tsx      # Main game display</span></span>
<span class="line"><span>│   │   ├── Console.tsx    # Command interface</span></span>
<span class="line"><span>│   │   ├── EventTree.tsx  # Decision history</span></span>
<span class="line"><span>│   │   └── UserActions.tsx # Action buttons</span></span>
<span class="line"><span>│   ├── hooks/             # Custom React hooks</span></span>
<span class="line"><span>│   ├── services/          # API services</span></span>
<span class="line"><span>│   └── types/             # TypeScript definitions</span></span>
<span class="line"><span>├── public/                # Static assets</span></span>
<span class="line"><span>└── dist/                  # Built application</span></span></code></pre>
<h3 id="data-flow">Data Flow</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Player Input → Socket.IO → Engine → AI Agents → Story Generation → Frontend Update</span></span>
<span class="line"><span>     ↑                                    ↓</span></span>
<span class="line"><span>Save System ← Delta Storage ← Game State ← Reality Validation</span></span></code></pre>
<h2 id="configuration">Configuration</h2>
<h3 id="story-creation">Story Creation</h3>
<p>Create new stories by adding directories to <code>data/story/</code>:</p>
<p><strong>world_definition.yaml</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#85E89D">world_definition</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  story_name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"Your Story Title"</span></span>
<span class="line"><span style="color:#85E89D">  core_concept</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"Central theme or question"</span></span>
<span class="line"><span style="color:#85E89D">  ontological_layers</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    surface_narrative</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      official_story</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"What appears to happen"</span></span>
<span class="line"><span style="color:#85E89D">      rules</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">"Surface world rules"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#85E89D">    underlying_structure</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">      hidden_truth</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"Deeper reality"</span></span>
<span class="line"><span style="color:#85E89D">      rules</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">"Hidden mechanics"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#85E89D">  protagonist_intent</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"Player's initial goal"</span></span>
<span class="line"><span style="color:#85E89D">  endings</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">    good_ending</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"Positive resolution"</span></span>
<span class="line"><span style="color:#85E89D">    bad_ending</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"Negative outcome"</span></span></code></pre>
<p><strong>condition_tree.yaml</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#85E89D">tree_id</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"your_story"</span></span>
<span class="line"><span style="color:#85E89D">root_conditions</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">"start"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#85E89D">terminal_conditions</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">"ending"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#85E89D">nodes</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">node_id</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"start"</span></span>
<span class="line"><span style="color:#85E89D">    symbolic_goal</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"Begin the adventure"</span></span>
<span class="line"><span style="color:#85E89D">    default_interpretation</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"You find yourself..."</span></span>
<span class="line"><span style="color:#85E89D">    dependencies</span><span style="color:#E1E4E8">: []</span></span></code></pre> </div>  </div> </div> </main> <footer class="project-footer" data-astro-cid-5uq7evlv> <div class="container" data-astro-cid-5uq7evlv> <a href="/projects/" class="back-link" data-astro-cid-5uq7evlv>← Back to Projects</a> </div> </footer> </article>  </main>  </main> <footer class="site-footer" data-astro-cid-37fxchfa> <div class="footer-content" data-astro-cid-37fxchfa> <p data-astro-cid-37fxchfa>&copy; 2025 Xiaoyou Wu. All rights reserved.</p> <div class="footer-links" data-astro-cid-37fxchfa> <a href="https://github.com/yourusername" target="_blank" rel="noopener noreferrer" data-astro-cid-37fxchfa>GitHub</a> <a href="https://linkedin.com/in/yourprofile" target="_blank" rel="noopener noreferrer" data-astro-cid-37fxchfa>LinkedIn</a> <a href="/resume.pdf" target="_blank" rel="noopener noreferrer" data-astro-cid-37fxchfa>Resume</a> </div> </div> </footer> <!-- KaTeX JavaScript for Math Rendering --> <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInDocument()"></script> <script>
    function renderMathInDocument() {
      if (typeof window.renderMathInElement !== 'undefined') {
        window.renderMathInElement(document.body, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
            {left: '\\(', right: '\\)', display: false},
            {left: '\\[', right: '\\]', display: true}
          ],
          throwOnError: false
        });
      }
    }
    
    document.addEventListener("DOMContentLoaded", renderMathInDocument);
  </script> <!-- Simple Mermaid Test Script --> <script type="module">
    console.log('[Simple Mermaid Test] Starting...');

    // Simple function to load and initialize Mermaid
    async function loadAndTestMermaid() {
      try {
        console.log('[Simple Mermaid Test] Loading Mermaid from CDN...');
        
        // Load Mermaid if not already loaded
        if (!window.mermaid) {
          const script = document.createElement('script');
          script.src = 'https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js';
          
          await new Promise((resolve, reject) => {
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
          });
          
          console.log('[Simple Mermaid Test] Mermaid loaded from CDN');
        } else {
          console.log('[Simple Mermaid Test] Mermaid already available');
        }

        if (!window.mermaid) {
          throw new Error('Mermaid not available after loading');
        }

        console.log('[Simple Mermaid Test] Initializing Mermaid...');
        
        // Initialize Mermaid with simple config
        window.mermaid.initialize({
          startOnLoad: false,
          theme: 'neutral'
        });

        console.log('[Simple Mermaid Test] Finding diagram elements...');
        
        // Find all mermaid diagrams
        const diagrams = document.querySelectorAll('.mermaid-diagram');
        console.log(`[Simple Mermaid Test] Found ${diagrams.length} diagrams`);

        // Process each diagram
        for (let i = 0; i < diagrams.length; i++) {
          const diagram = diagrams[i];
          const id = diagram.id || `test-diagram-${i}`;
          const codeElement = diagram.querySelector('.mermaid-code code');
          
          console.log(`[Simple Mermaid Test] Processing diagram ${id}`);
          
          if (codeElement) {
            const code = codeElement.textContent.trim();
            console.log(`[Simple Mermaid Test] Code for ${id}:`, code.substring(0, 100) + '...');
            
            try {
              // Render the diagram
              const { svg } = await window.mermaid.render(`${id}-render`, code);
              console.log(`[Simple Mermaid Test] SVG generated for ${id}`);
              
              // Replace the loading text with the SVG
              const container = diagram.querySelector('.mermaid-container');
              if (container) {
                container.innerHTML = svg;
                console.log(`[Simple Mermaid Test] SVG inserted for ${id}`);
              } else {
                console.error(`[Simple Mermaid Test] No container found for ${id}`);
              }
              
            } catch (renderError) {
              console.error(`[Simple Mermaid Test] Render error for ${id}:`, renderError);
              
              const container = diagram.querySelector('.mermaid-container');
              if (container) {
                container.innerHTML = `<div style="color: red; padding: 1rem;">Error: ${renderError.message}</div>`;
              }
            }
          } else {
            console.error(`[Simple Mermaid Test] No code element found for ${id}`);
          }
        }

        console.log('[Simple Mermaid Test] Completed processing all diagrams');
        
      } catch (error) {
        console.error('[Simple Mermaid Test] Fatal error:', error);
      }
    }

    // Run the test when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadAndTestMermaid);
    } else {
      loadAndTestMermaid();
    }

    // Export for manual testing
    window.testMermaid = loadAndTestMermaid;
  </script> </body> </html>   