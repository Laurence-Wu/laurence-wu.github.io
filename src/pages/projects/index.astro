---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { getUrl } from '../../utils/url';

const allProjects = await getCollection('projects');
const sortedProjects = allProjects.sort((a, b) =>
  b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout title="Projects - Xiaoyou Wu" description="Engineering and software projects">
  <div class="container">
    <header class="page-header">
      <h1>Projects</h1>
    </header>

    <div class="project-list">
      {sortedProjects.map(project => (
        <article class="project-item">
          <header class="project-header">
            <h3>
              <a href={getUrl(`/projects/${project.slug}/`)}>{project.data.title}</a>
            </h3>
            <div class="project-links">
               <a href={getUrl(`/projects/${project.slug}/`)} class="link-secondary">Read</a>
               {project.data.githubLink && (
                  <span class="separator">â€¢</span>
               )}
               {project.data.githubLink && (
                 <a href={project.data.githubLink} target="_blank" rel="noopener noreferrer" class="link-secondary">Code</a>
               )}
            </div>
          </header>

          <p class="project-description">{project.data.description}</p>

          <div class="project-tags">
            {project.data.tags?.map((tag: string) => (
              <span class="tag">#{tag}</span>
            ))}
          </div>
        </article>
      ))}
    </div>
  </div>
</BaseLayout>

<style>
  .page-header {
    text-align: center;
    margin-bottom: 4rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--border-subtle);
  }

  .page-header h1 {
    font-size: 2.5rem;
    color: var(--text-primary);
  }

  .project-list {
    max-width: var(--max-width-text);
    margin: 0 auto;
  }

  .project-item {
    margin-bottom: 3.5rem;
  }

  .project-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 0.5rem;
  }

  .project-header h3 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
  }

  .project-header h3 a {
    color: var(--text-primary);
    text-decoration: none;
    border-bottom: none;
  }

  .project-header h3 a:hover {
    color: var(--accent);
  }

  .project-links {
    font-family: var(--font-sans);
    font-size: 0.9rem;
  }

  .link-secondary {
    color: var(--text-secondary);
    text-decoration: none;
  }

  .link-secondary:hover {
    color: var(--accent);
  }

  .separator {
    margin: 0 0.3rem;
    color: var(--border-subtle);
  }

  .project-description {
    font-size: 1.1rem;
    color: var(--text-secondary);
    margin-bottom: 0.8rem;
  }

  .project-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.8rem;
  }

  .tag {
    font-family: var(--font-mono);
    font-size: 0.8rem;
    color: var(--text-secondary);
  }

  @media (max-width: 600px) {
    .project-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }
  }
</style>
